<!DOCTYPE html>
<html>

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   <title>Backbone Model</title>
</head>

<body>
   <div id="container">
      <h1>TODO List:<h1>
      <input id="new-todo" placeholder="What needs to be done?" autofocus>
      <button id="add-todo">create</button>
      <ul id="todo-list"></ul>
   </div>

   <!-- Template to show a Todo: checkbox + removeButton -->
   <script type="text/template" id="item-template">
      <label><%= title %></label>  <button class="destroy">destroy</button>
   </script>

   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
   <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"
      type="text/javascript"></script>
   <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"
      type="text/javascript"></script>

   <script type="text/javascript">
      'use strict';

      var app = {};

      /************************
       * Model and Collection
       * Brief: TodoList Collection owns Todo Model
       ************************/
      app.Todo = Backbone.Model.extend({
         defaults: {
            title: ''
         }
      });
      app.TodoList = Backbone.Collection.extend({
         model: app.Todo,
      });
      app.todoList = new app.TodoList();

      /********
       * View
       * Brief: AppView --new--> TodoListView --new--> TodoView
       ********/
      app.TodoView = Backbone.View.extend({
         // this.el can be resolved from a DOM selector string or an Element;
         // otherwise it will be created from the view's tagName, className,
         // id and attributes properties. So, TodoView is a tag.
         tagName: 'li',
         template: _.template($('#item-template').html()),
         render: function () {
            // Todo model is passed in during creation
            this.$el.html(this.template(this.model.toJSON()));
            return this; // enable chained calls
         },
      });

      // Add TodoView to TodoListView when a model is added to the collection
      app.TodoListView = Backbone.View.extend({
         el: '#todo-list',
         initialize: function () {
            app.todoList.on('add', function(todo) {
               let todo_view = new app.TodoView({model: todo});
               this.$el.append(todo_view.render().el);
            }, this); // have to add "this" context to get "$el" in the function
         },
      });

      // Main View for all view update
      app.AppView = Backbone.View.extend({
         el: '#container',
         events: {
            'click #add-todo': 'addOneTodo',
         },
         initialize: function () {
            this.user_input = this.$('#new-todo');
            this.todoListView = new app.TodoListView();
         },
         addOneTodo: function (e) {
            let todo_title = this.user_input.val().trim();
            if (!todo_title) {
               // empty todo tile, do nothing
               return;
            }
            // "add" event to be triggered on the collection
            app.todoList.add({ title: todo_title });
            this.user_input.val(""); // clean input box
         },
      });
      app.appView = new app.AppView();

   </script>

</body>

</html>